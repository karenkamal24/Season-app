# ðŸ¤– AI-Powered Smart Packing API Documentation
## Gemini AI Integration - Travel Bag Feature

---

## ðŸ“‹ Table of Contents

1. [Overview](#overview)
2. [Authentication](#authentication)
3. [Language Support](#language-support)
4. [Endpoints](#endpoints)
   - [Get AI Categories](#1-get-ai-categories)
   - [Get AI Suggested Items](#2-get-ai-suggested-items)
   - [Add AI Item to Bag](#3-add-ai-item-to-bag)
5. [Request/Response Examples](#requestresponse-examples)
6. [Error Handling](#error-handling)

---

## ðŸŽ¯ Overview

This API provides AI-powered smart packing features using Google's Gemini AI. It allows users to:
- Get AI-generated packing categories
- Get AI-suggested items for each category with estimated weights
- Add AI-suggested items to their travel bag

---

## ðŸ” Authentication

All endpoints require authentication using Bearer token:

```
Authorization: Bearer YOUR_API_TOKEN
```

---

## ðŸŒ Language Support

The API supports **Arabic (ar)** and **English (en)** languages.

### Language Detection Priority:
1. Query parameter: `?language=en` or `?language=ar`
2. `Accept-Language` header: `Accept-Language: en` or `Accept-Language: ar`
3. App locale (set by middleware)
4. Default: `ar` (Arabic)

### Example Headers:
```http
Accept-Language: ar
# or
Accept-Language: en
```

---

## ðŸ“¡ Endpoints

### Base URLs

**Smart Bags (Bag Model):**
```
/api/smart-bags
```

**Travel Bag (TravelBag Model):**
```
/api/travel-bag
```

---

## 1. Get Categories

Get packing categories from database (ItemCategory table).

### Smart Bags Endpoint

**Request:**
```http
GET /api/smart-bags/ai/categories
Authorization: Bearer YOUR_TOKEN
Accept-Language: ar
```

**Query Parameters:**
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `language` | string | No | Language code (`ar` or `en`). If not provided, uses `Accept-Language` header or app locale |

**Response (200 OK):**
```json
{
  "success": true,
  "message": "Categories retrieved successfully",
  "data": {
    "categories": [
      {
        "id": 1,
        "name": "Ø§Ù„Ù…Ù„Ø§Ø¨Ø³",
        "name_ar": "Ø§Ù„Ù…Ù„Ø§Ø¨Ø³",
        "name_en": "Clothing",
        "icon": "shirt",
        "icon_color": "#3498db",
        "sort_order": 1
      },
      {
        "id": 2,
        "name": "Ù…Ø³ØªÙ„Ø²Ù…Ø§Øª Ø§Ù„Ù†Ø¸Ø§ÙØ©",
        "name_ar": "Ù…Ø³ØªÙ„Ø²Ù…Ø§Øª Ø§Ù„Ù†Ø¸Ø§ÙØ©",
        "name_en": "Toiletries",
        "icon": "soap",
        "icon_color": "#9b59b6",
        "sort_order": 2
      },
      {
        "id": 3,
        "name": "Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª",
        "name_ar": "Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª",
        "name_en": "Electronics",
        "icon": "phone",
        "icon_color": "#e74c3c",
        "sort_order": 3
      }
    ],
    "language": "ar"
  }
}
```

**Note:** Categories are retrieved from the database (`item_categories` table), not generated by AI.

### Travel Bag Endpoint

**Request:**
```http
GET /api/travel-bag/ai/categories
Authorization: Bearer YOUR_TOKEN
Accept-Language: ar
```

**Response:** Same format as Smart Bags endpoint

---

## 2. Get AI Suggested Items

Get AI-suggested items for a specific category with estimated weights.

### Smart Bags Endpoint

**Request:**
```http
GET /api/smart-bags/ai/suggest-items?item_category_id=1
Authorization: Bearer YOUR_TOKEN
Accept-Language: ar
```

**Query Parameters:**
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `item_category_id` | integer | **Yes** | Category ID (from ItemCategory table) |
| `language` | string | No | Language code (`ar` or `en`) |

**Response (200 OK):**
```json
{
  "success": true,
  "message": "AI items suggested successfully",
  "data": {
    "category": {
      "id": 1,
      "name": "Ø§Ù„Ù…Ù„Ø§Ø¨Ø³",
      "name_ar": "Ø§Ù„Ù…Ù„Ø§Ø¨Ø³",
      "name_en": "Clothing",
      "icon": "shirt",
      "icon_color": "#3498db"
    },
    "items": [
      {
        "name": "Ù‚Ù…ÙŠØµ",
        "weight": 0.15,
        "weight_grams": 150
      },
      {
        "name": "Ø¨Ù†Ø·Ø§Ù„",
        "weight": 0.5,
        "weight_grams": 500
      },
      {
        "name": "Ù…Ù„Ø§Ø¨Ø³ Ø¯Ø§Ø®Ù„ÙŠØ©",
        "weight": 0.05,
        "weight_grams": 50
      },
      {
        "name": "Ø¬ÙˆØ§Ø±Ø¨",
        "weight": 0.04,
        "weight_grams": 40
      },
      {
        "name": "ØªÙŠØ´ÙŠØ±Øª",
        "weight": 0.2,
        "weight_grams": 200
      },
      {
        "name": "Ø¬Ø§ÙƒÙŠØª",
        "weight": 0.8,
        "weight_grams": 800
      },
      {
        "name": "Ø­Ø°Ø§Ø¡ Ø±ÙŠØ§Ø¶ÙŠ",
        "weight": 0.6,
        "weight_grams": 600
      },
      {
        "name": "Ø´ÙˆØ±Øª",
        "weight": 0.12,
        "weight_grams": 120
      },
      {
        "name": "Ù‚Ù…ÙŠØµ Ø·ÙˆÙŠÙ„",
        "weight": 0.25,
        "weight_grams": 250
      },
      {
        "name": "Ø¬ÙŠÙ†Ø²",
        "weight": 0.6,
        "weight_grams": 600
      }
    ],
    "language": "ar"
  }
}
```

**English Response:**
```json
{
  "success": true,
  "message": "AI items suggested successfully",
  "data": {
    "category": "Clothing",
    "items": [
      {
        "name": "T-Shirt",
        "weight": 0.15,
        "weight_grams": 150
      },
      {
        "name": "Jeans",
        "weight": 0.5,
        "weight_grams": 500
      },
      {
        "name": "Underwear",
        "weight": 0.05,
        "weight_grams": 50
      }
    ],
    "language": "en"
  }
}
```

**Note:** 
- `weight` is in **kilograms (kg)**
- `weight_grams` is the original weight in grams (for reference)

### Travel Bag Endpoint

**Request:**
```http
GET /api/travel-bag/ai/suggest-items?category=Ø§Ù„Ù…Ù„Ø§Ø¨Ø³
Authorization: Bearer YOUR_TOKEN
Accept-Language: ar
```

**Response:** Same format as Smart Bags endpoint

---

## 3. Add AI Item to Bag

Add an AI-suggested item to the user's bag with weight and essential flag.

### Smart Bags Endpoint

**Request:**
```http
POST /api/smart-bags/{bagId}/ai/add-item
Authorization: Bearer YOUR_TOKEN
Content-Type: application/json
```

**Path Parameters:**
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `bagId` | integer | **Yes** | Bag ID |

**Request Body:**
```json
{
  "item_name": "Ù‚Ù…ÙŠØµ",
  "weight": 0.15,
  "essential": true,
  "item_category_id": 1,
  "quantity": 1
}
```

**Body Parameters:**
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `item_name` | string | **Yes** | Item name (from AI suggestions) |
| `weight` | float | **Yes** | Weight in kilograms (kg). Min: 0, Max: 999.99 |
| `essential` | boolean | No | Is this item essential? Default: `false` |
| `item_category_id` | integer | No | Category ID (optional, can be null) |
| `quantity` | integer | No | Quantity. Default: `1`, Min: 1 |

**Response (201 Created):**
```json
{
  "success": true,
  "message": "AI item added successfully",
  "data": {
    "item": {
      "id": 123,
      "name": "Ù‚Ù…ÙŠØµ",
      "weight": 0.15,
      "total_weight": 0.15,
      "item_category_id": 1,
      "category": {
        "id": 1,
        "name": "Ø§Ù„Ù…Ù„Ø§Ø¨Ø³",
        "name_ar": "Ø§Ù„Ù…Ù„Ø§Ø¨Ø³",
        "name_en": "Clothing",
        "icon": "shirt",
        "icon_color": "#3498db"
      },
      "essential": true,
      "packed": false,
      "quantity": 1,
      "notes": null,
      "created_at": "2026-01-10T19:30:00+00:00",
      "updated_at": "2026-01-10T19:30:00+00:00"
    },
    "bag": {
      "current_weight": 5.25,
      "max_weight": 20.0,
      "weight_percentage": 26.25
    }
  }
}
```

**Error Response (400 Bad Request) - Weight Exceeded:**
```json
{
  "success": false,
  "message": "Cannot add more items. Weight limit exceeded."
}
```

**Error Response (404 Not Found) - Bag Not Found:**
```json
{
  "success": false,
  "message": "Bag not found"
}
```

**Error Response (422 Unprocessable Entity) - Validation Error:**
```json
{
  "success": false,
  "message": "Validation failed",
  "errors": {
    "item_name": [
      "Ø§Ø³Ù… Ø§Ù„ØºØ±Ø¶ Ù…Ø·Ù„ÙˆØ¨"
    ],
    "weight": [
      "ÙˆØ²Ù† Ø§Ù„ØºØ±Ø¶ Ù…Ø·Ù„ÙˆØ¨"
    ]
  }
}
```

### Travel Bag Endpoint

**Request:**
```http
POST /api/travel-bag/ai/add-item
Authorization: Bearer YOUR_TOKEN
Content-Type: application/json
```

**Request Body:**
```json
{
  "item_name": "Ù‚Ù…ÙŠØµ",
  "weight": 0.15,
  "essential": true,
  "bag_type_id": 1,
  "quantity": 1
}
```

**Body Parameters:**
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `item_name` | string | **Yes** | Item name (from AI suggestions) |
| `weight` | float | **Yes** | Weight in kilograms (kg) |
| `essential` | boolean | No | Is this item essential? Default: `false` |
| `bag_type_id` | integer | No | Bag type ID. Default: `1` |
| `quantity` | integer | No | Quantity. Default: `1` |

**Response:** Similar format to Smart Bags endpoint

---

## ðŸ“ Complete Flow Example

### Step 1: Get Categories from Database
```http
GET /api/smart-bags/ai/categories
Authorization: Bearer YOUR_TOKEN
Accept-Language: ar
```

### Step 2: Get AI Suggested Items for a Category
```http
GET /api/smart-bags/ai/suggest-items?item_category_id=1
Authorization: Bearer YOUR_TOKEN
Accept-Language: ar
```

### Step 3: User Selects an Item â†’ Show Dialog/Bottom Sheet
Display:
- Item name: "Ù‚Ù…ÙŠØµ"
- Weight: 0.15 kg (editable)
- Essential toggle: true/false
- Add button

### Step 4: Add Item to Bag
```http
POST /api/smart-bags/1/ai/add-item
Authorization: Bearer YOUR_TOKEN
Content-Type: application/json

{
  "item_name": "Ù‚Ù…ÙŠØµ",
  "weight": 0.15,
  "essential": true,
  "quantity": 1
}
```

---

## âš ï¸ Error Handling

### Common Error Codes

| Status Code | Description |
|-------------|-------------|
| `400` | Bad Request - Invalid parameters or weight exceeded |
| `401` | Unauthorized - Missing or invalid token |
| `404` | Not Found - Bag or resource not found |
| `422` | Validation Error - Invalid request data |
| `500` | Server Error - Internal server error or AI service error |

### Error Response Format
```json
{
  "success": false,
  "message": "Error message here",
  "errors": {
    "field_name": [
      "Error message for this field"
    ]
  }
}
```

---

## ðŸ”„ Integration Flow for Frontend

### 1. When User Opens Bag Screen:

```javascript
// 1. Get Categories from Database
const response = await fetch('/api/smart-bags/ai/categories', {
  headers: {
    'Authorization': `Bearer ${token}`,
    'Accept-Language': 'ar' // or 'en'
  }
});

const { data } = await response.json();
const categories = data.categories; // Array of { id, name, name_ar, name_en, icon, icon_color }

// 2. Display categories as horizontal scrollable chips
categories.forEach(category => {
  // Render chip with category.name and category.id
  // Store category.id for next step
});
```

### 2. When User Taps a Category:

```javascript
// Get AI Suggested Items using category ID
const categoryId = 1; // From selected category
const response = await fetch(
  `/api/smart-bags/ai/suggest-items?item_category_id=${categoryId}`,
  {
    headers: {
      'Authorization': `Bearer ${token}`,
      'Accept-Language': 'ar'
    }
  }
);

const { data } = await response.json();
const items = data.items; // Array of { name, weight, weight_grams }
const category = data.category; // Category info with id, name, icon, etc.

// Display items as selectable list
items.forEach(item => {
  // Render item with item.name, item.weight
});
```

### 3. When User Selects an Item:

```javascript
// Show dialog/bottom sheet with:
// - Item name (from AI)
// - Weight input (editable, default from AI)
// - Essential toggle
// - Add button

const selectedItem = {
  name: "Ù‚Ù…ÙŠØµ",
  weight: 0.15, // kg
  essential: false // user decides
};

// When user clicks "Add"
const response = await fetch(`/api/smart-bags/${bagId}/ai/add-item`, {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${token}`,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    item_name: selectedItem.name,
    weight: selectedItem.weight, // User can edit this
    essential: selectedItem.essential, // User decides
    quantity: 1
  })
});

const result = await response.json();
if (result.success) {
  // Item added successfully
  // Update bag UI with new weight
  console.log('Bag weight:', result.data.bag.current_weight);
}
```

---

## ðŸ“± Mobile App Integration Example (Flutter/Dart)

```dart
// 1. Get Categories from Database
Future<List<Category>> getCategories(String language) async {
  final response = await http.get(
    Uri.parse('$baseUrl/api/smart-bags/ai/categories?language=$language'),
    headers: {
      'Authorization': 'Bearer $token',
      'Accept-Language': language,
    },
  );
  
  final data = jsonDecode(response.body);
  return (data['data']['categories'] as List)
      .map((cat) => Category(
        id: cat['id'],
        name: cat['name'],
        nameAr: cat['name_ar'],
        nameEn: cat['name_en'],
        icon: cat['icon'],
        iconColor: cat['icon_color'],
      ))
      .toList();
}

// 2. Get AI Suggested Items
Future<CategoryItems> getAISuggestedItems(int categoryId, String language) async {
  final response = await http.get(
    Uri.parse('$baseUrl/api/smart-bags/ai/suggest-items?item_category_id=$categoryId&language=$language'),
    headers: {
      'Authorization': 'Bearer $token',
      'Accept-Language': language,
    },
  );
  
  final data = jsonDecode(response.body);
  final categoryData = data['data']['category'];
  return CategoryItems(
    category: Category(
      id: categoryData['id'],
      name: categoryData['name'],
      nameAr: categoryData['name_ar'],
      nameEn: categoryData['name_en'],
      icon: categoryData['icon'],
      iconColor: categoryData['icon_color'],
    ),
    items: (data['data']['items'] as List)
        .map((item) => AIItem(
          name: item['name'],
          weight: item['weight'].toDouble(),
          weightGrams: item['weight_grams'],
        ))
        .toList(),
  );
}

class Category {
  final int id;
  final String name;
  final String nameAr;
  final String nameEn;
  final String icon;
  final String iconColor;
  
  Category({
    required this.id,
    required this.name,
    required this.nameAr,
    required this.nameEn,
    required this.icon,
    required this.iconColor,
  });
}

class CategoryItems {
  final Category category;
  final List<AIItem> items;
  
  CategoryItems({
    required this.category,
    required this.items,
  });
}

// 3. Add AI Item to Bag
Future<bool> addAIItemToBag({
  required int bagId,
  required String itemName,
  required double weight,
  required bool essential,
  int quantity = 1,
}) async {
  final response = await http.post(
    Uri.parse('$baseUrl/api/smart-bags/$bagId/ai/add-item'),
    headers: {
      'Authorization': 'Bearer $token',
      'Content-Type': 'application/json',
    },
    body: jsonEncode({
      'item_name': itemName,
      'weight': weight,
      'essential': essential,
      'quantity': quantity,
    }),
  );
  
  return jsonDecode(response.body)['success'] == true;
}

class AIItem {
  final String name;
  final double weight;
  final int weightGrams;
  
  AIItem({
    required this.name,
    required this.weight,
    required this.weightGrams,
  });
}
```

---

## ðŸŽ¨ UI Flow Recommendations

### 1. Categories Screen
- Display categories as **horizontal scrollable chips**
- Each chip shows category name
- When tapped, navigate to items screen

### 2. Items Screen
- Display items as **selectable list**
- Each item shows:
  - Item name
  - Estimated weight (from AI)
- When item tapped, show dialog/bottom sheet

### 3. Add Item Dialog/Bottom Sheet
- **Item name** (read-only, from AI)
- **Weight input** (editable text field, default from AI)
- **"Is Essential?" toggle/checkbox** (user decides)
- **"Add" button**

### 4. After Adding Item
- Show success message
- Update bag weight display
- Refresh items list
- Close dialog

---

## ðŸ”— Related Endpoints

### Get Bag Details
```http
GET /api/smart-bags/{bagId}
Authorization: Bearer YOUR_TOKEN
```

### Get Bag Items
```http
GET /api/smart-bags/{bagId}/items
Authorization: Bearer YOUR_TOKEN
```

### Add Regular Item (without AI)
```http
POST /api/smart-bags/{bagId}/items
Authorization: Bearer YOUR_TOKEN
Content-Type: application/json

{
  "name": "Custom Item",
  "weight": 0.5,
  "item_category_id": 1,
  "essential": false,
  "quantity": 1
}
```

---

## ðŸ“Œ Notes

1. **Weight Units**: All weights are in **kilograms (kg)**
2. **Language**: Always send `Accept-Language` header for consistent responses
3. **Essential Flag**: User decides if item is essential when adding
4. **Weight Validation**: System checks if adding item exceeds max weight
5. **Category ID**: Optional for AI items, but recommended for better organization

---

## ðŸš€ Quick Start

1. **Authenticate** and get Bearer token
2. **Create a bag** using `/api/smart-bags` POST endpoint
3. **Get AI categories** using `/api/smart-bags/ai/categories`
4. **Get AI items** for a category using `/api/smart-bags/ai/suggest-items`
5. **Add items** to bag using `/api/smart-bags/{bagId}/ai/add-item`

---

**Last Updated:** January 10, 2026
**API Version:** 1.0

