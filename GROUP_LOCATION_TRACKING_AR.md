# ๐ Group Location Tracking - ุชุชุจุน ูููุน ุงููุฌููุนุฉ

## ๐ฏ ูุธุฑุฉ ุนุงูุฉ

ุงูู Endpoint ุฏู ุจูุณูุญ ูุฃุนุถุงุก ุงููุฌููุนุฉ ูุญุฏุซูุง ูููุนูู ุงูุญุงููุ ููุญุณุจ ุงููุณุงูุฉ ุจูููู ูุจูู **ูุงุฆุฏ ุงููุฌููุนุฉ**ุ ููุฑุณู ุชูุจููุงุช ูู ุฃู ุนุถู ุฎุฑุฌ ุนู ูุทุงู ุงูุฃูุงู!

---

## ๐ก Endpoint Details

**URL:** `POST /api/groups/{groupId}/location`

**ูุซุงู:** `POST /api/groups/2/location`

**Headers:**
```
Authorization: Bearer YOUR_TOKEN
Accept-Language: ar
Content-Type: application/json
```

**Body:**
```json
{
  "latitude": 24.7136,
  "longitude": 46.6753
}
```

**ุงูุญููู ุงููุทููุจุฉ:**

| Field | Type | Required | Description | Validation |
|-------|------|----------|-------------|------------|
| `latitude` | decimal | โ | ุฎุท ุงูุนุฑุถ | ูู -90 ุฅูู 90 |
| `longitude` | decimal | โ | ุฎุท ุงูุทูู | ูู -180 ุฅูู 180 |

---

## โ Response - ุงูุงุณุชุฌุงุจุฉ

### ุนุถู ุนุงุฏู (Member)

```json
{
  "success": true,
  "status": 200,
  "message": "ุชู ุชุญุฏูุซ ุงููููุน ุจูุฌุงุญ",
  "data": {
    "id": 15,
    "user_id": 5,
    "user": {
      "id": 5,
      "name": "ุฃุญูุฏ ูุญูุฏ",
      "email": "ahmed@example.com",
      "avatar": "https://example.com/avatar.jpg"
    },
    "latitude": 24.7136,
    "longitude": 46.6753,
    "distance_from_center": 1250.50,
    "is_within_radius": true,
    "created_at": "2026-01-03T10:00:00+00:00",
    "updated_at": "2026-01-03T10:00:00+00:00"
  }
}
```

### ูุงุฆุฏ ุงููุฌููุนุฉ (Owner/Admin)

```json
{
  "success": true,
  "status": 200,
  "message": "ุชู ุชุญุฏูุซ ุงููููุน ุจูุฌุงุญ",
  "data": {
    "id": 16,
    "user_id": 1,
    "latitude": 24.7136,
    "longitude": 46.6753,
    "distance_from_center": 0,
    "is_within_radius": true
  }
}
```

**๐ก ููุงุญุธุฉ:** ุงููุงุฆุฏ/ุงูุฃุฏูู ุฏุงุฆูุงู `distance_from_center = 0` ูุฃูู **ูู ุงููุฑูุฒ**!

---

## ๐ง ููู ูุนูู ุงููุธุงูุ

### 1๏ธโฃ ุชุญุฏูุฏ ุงููุฑูุฒ (Center Point)

```
ุงููุฑูุฒ = ูููุน ูุงุฆุฏ ุงููุฌููุนุฉ (Owner)
```

- ูุงุฆุฏ ุงููุฌููุนุฉ ูู **ููุทุฉ ุงููุฑูุฒ** ุฏุงุฆูุงู
- ุงููุณุงูุฉ ุจููู ูุจูู ููุณู = **0 ูุชุฑ**
- ุฏุงุฆูุงู **ุฏุงุฎู ุงููุทุงู** (is_within_radius = true)

---

### 2๏ธโฃ ุญุณุงุจ ุงููุณุงูุฉ ููุฃุนุถุงุก

**ุจุงุณุชุฎุฏุงู Haversine Formula:**

**ูุซุงู:**
```
ูููุน ุงููุงุฆุฏ: (24.7136, 46.6753)
ูููุน ุงูุนุถู:   (24.7200, 46.6800)
ุงููุณุงูุฉ ุงููุญุณูุจุฉ: 750.25 ูุชุฑ
ูุทุงู ุงูุฃูุงู: 1000 ูุชุฑ
ุงููุชูุฌุฉ: โ ุฏุงุฎู ุงููุทุงู
```

---

### 3๏ธโฃ ุญุงูุงุช ุงููููุน

#### โ ุฏุงุฎู ุงููุทุงู
```json
{
  "distance_from_center": 750.25,
  "is_within_radius": true
}
```
- ูุง ูุชู ุฅุฑุณุงู ุชูุจููุงุช

#### โ๏ธ ุฎุงุฑุฌ ุงููุทุงู
```json
{
  "distance_from_center": 1500.75,
  "is_within_radius": false
}
```
- **ูุชู ุฅุฑุณุงู ุชูุจูู ูููุงุฆุฏ** ๐จ

---

### 4๏ธโฃ ูุธุงู ุงูุชูุจููุงุช

#### ูุชู ููุฑุณู ุงูุชูุจููุ

**ุดุฑุท 1:** ุงูุนุถู ุงูุชูู ูู ุฏุงุฎู โ ุฎุงุฑุฌ ุงููุทุงู
**ุดุฑุท 2:** ุงูุชูุจููุงุช ููุนููุฉ ูู ุงููุฌููุนุฉ
**ุดุฑุท 3:** ูู ููุฑุณู ุชูุจูู ูู ูุชุฑุฉ ูุฑูุจุฉ (< 5 ุฏูุงุฆู)

#### ูู ูุณุชูู ุงูุชูุจููุ

**ููุฑุณู ูููุงุฆุฏ/ุงูุฃุฏูู ููุท:**
```json
{
  "type": "member_out_of_range",
  "title": "ุนุถู ุฎุฑุฌ ุนู ูุทุงู ุงูุฃูุงู",
  "message": "ุฃุญูุฏ ูุญูุฏ ุงุจุชุนุฏ 1500 ูุชุฑ",
  "data": {
    "group_id": 2,
    "member_id": 5,
    "distance": 1500.75
  }
}
```

---

## ๐ฎ ุณููุงุฑูููุงุช ุงูุงุณุชุฎุฏุงู

### ๐ฑ ุณููุงุฑูู 1: ุฑุญูุฉ ุนุงุฆููุฉ

```
ุงููููู:
- ุนุงุฆูุฉ ูู ุฑุญูุฉ
- ุงูุฃุจ ูู ูุงุฆุฏ ุงููุฌููุนุฉ
- ูุทุงู ุงูุฃูุงู = 500 ูุชุฑ

1. ุงูุฃุจ ูุญุฏุซ ูููุนู (24.7136, 46.6753)
   โ distance = 0

2. ุงูุฃู ุชุญุฏุซ ูููุนูุง - ูุฑูุจุฉ
   โ distance = 45 ูุชุฑ โ

3. ุงูุงุจู ูุญุฏุซ ูููุนู - ุจุนูุฏ
   โ distance = 750 ูุชุฑ โ๏ธ
   โ ุชูุจูู ููุฃุจ!
```

---

### ๐ซ ุณููุงุฑูู 2: ุฑุญูุฉ ูุฏุฑุณูุฉ

```
ุงููููู:
- ูุฌููุนุฉ ุทูุงุจ
- ุงููุนูู ูู ุงููุงุฆุฏ
- ูุทุงู ุงูุฃูุงู = 1000 ูุชุฑ

1. ุงููุนูู ูู ุงููุชุญู
2. ุทุงูุจ 1 ูู ุงููุญู โ 45 ูุชุฑ โ
3. ุทุงูุจ 2 ูู ุงููุทุนู โ 750 ูุชุฑ โ
4. ุทุงูุจ 3 ุถุงุน! โ 1950 ูุชุฑ โ๏ธ
   โ ุชูุจูู ูููุนูู ููุฑุงู! ๐จ
```

---

### ๐ข ุณููุงุฑูู 3: ูุฑูู ุนูู

```
ุงููููู:
- ูุฑูู ูู ูุคุชูุฑ
- ุงููุฏูุฑ ูู ุงููุงุฆุฏ
- ูุทุงู ุงูุฃูุงู = 2000 ูุชุฑ

- ููุธู 1 โ 300 ูุชุฑ โ
- ููุธู 2 โ 800 ูุชุฑ โ
- ููุธู 3 โ 1500 ูุชุฑ โ
- ููุธู 4 โ 3000 ูุชุฑ โ๏ธ
```

---

## โ๏ธ ูุนุงุฏูุฉ Haversine

```javascript
function calculateDistance(lat1, lon1, lat2, lon2) {
  const earthRadius = 6371000; // ุจุงููุชุฑ

  const dLat = deg2rad(lat2 - lat1);
  const dLon = deg2rad(lon2 - lon1);

  const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
            Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) *
            Math.sin(dLon/2) * Math.sin(dLon/2);

  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));

  return earthRadius * c; // ุจุงููุชุฑ
}
```

---

## ๐ ุชุญุฏูุซุงุช ุชููุงุฆูุฉ

```javascript
// ุชุญุฏูุซ ุชููุงุฆู ูู 30 ุซุงููุฉ
useEffect(() => {
  const interval = setInterval(() => {
    navigator.geolocation.getCurrentPosition((pos) => {
      updateLocation(groupId, {
        latitude: pos.coords.latitude,
        longitude: pos.coords.longitude
      });
    });
  }, 30000);

  return () => clearInterval(interval);
}, [groupId]);
```

---

## โ ุฃุฎุทุงุก ูุญุชููุฉ

### 1. ููุณ ุนุถู ูู ุงููุฌููุนุฉ
```json
{
  "success": false,
  "status": 404,
  "message": "Group member not found"
}
```

### 2. ุฅุญุฏุงุซูุงุช ุบูุฑ ุตุญูุญุฉ
```json
{
  "success": false,
  "status": 422,
  "errors": {
    "latitude": ["ูุฌุจ ุฃู ูููู ุจูู -90 ู 90"]
  }
}
```

---

## ๐ก ูุตุงุฆุญ ูููุฑููุช ุฅูุฏ

### 1. ุนุฑุถ ุนูู ุงูุฎุฑูุทุฉ
```javascript
<Map center={groupCenter}>
  {/* ุฏุงุฆุฑุฉ ุงูุฃูุงู */}
  <Circle
    center={groupCenter}
    radius={group.safety_radius}
    color="blue"
  />
  
  {/* ุงููุงุฆุฏ */}
  <Marker position={ownerLocation} icon="leader" />
  
  {/* ุงูุฃุนุถุงุก */}
  {members.map(m => (
    <Marker
      position={m.location}
      icon={m.is_within_radius ? "green" : "red"}
    />
  ))}
</Map>
```

---

### 2. ุชูุจูู ุจุตุฑู
```javascript
const MemberCard = ({ member }) => (
  <div className={!member.is_within_radius ? "bg-red-100" : "bg-white"}>
    <h3>{member.name}</h3>
    <p>ุงููุณุงูุฉ: {member.distance_from_center}ู</p>
    {!member.is_within_radius && (
      <Alert severity="error">
        โ๏ธ ุฎุงุฑุฌ ูุทุงู ุงูุฃูุงู!
      </Alert>
    )}
  </div>
);
```

---

## ๐ฏ ููุฎุต ุงูุณููุงุฑูู

### ูููุงุฆุฏ:
- โ ูุญุฏุซ ูููุนู โ ูุตุจุญ ุงููุฑูุฒ
- โ distance ุฏุงุฆูุงู = 0
- ๐ ูุณุชูู ุชูุจููุงุช

### ููุนุถู:
- ๐ ูุญุฏุซ ูููุนู
- ๐ ุชูุญุณุจ ุงููุณุงูุฉ
- โ๏ธ ุฅุฐุง ุฎุงุฑุฌ ุงููุทุงู โ ุชูุจูู

### ูููุธุงู:
- ๐พ ูุญูุธ ูู ุชุญุฏูุซ
- ๐ ูุญุณุจ ุงููุณุงูุฉ ุจุฏูุฉ
- ๐ ูุฑุณู ุชูุจููุงุช ุฐููุฉ

---

**ุขุฎุฑ ุชุญุฏูุซ:** ููุงูุฑ 2026  
**ุงูุฅุตุฏุงุฑ:** 1.0

