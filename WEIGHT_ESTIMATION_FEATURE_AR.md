# ميزة تقدير الوزن التلقائي للعناصر المخصصة

## المقدمة

تم إضافة ميزة جديدة تسمح بتقدير الوزن التلقائي للعناصر المخصصة باستخدام الذكاء الاصطناعي. عندما يدخل المستخدم اسم عنصر مخصص، يمكن للتطبيق الآن استدعاء API لتقدير الوزن المقدر لهذا العنصر تلقائياً.

---

## الوظيفة

عندما يختار المستخدم إضافة عنصر مخصص ويقوم بإدخال اسمه، يمكن للتطبيق استخدام هذه الميزة للحصول على وزن مقدر تلقائياً من الذكاء الاصطناعي، مما يوفر الوقت على المستخدم ويساعده في تخطيط وزن الحقيبة.

---

## الـ Endpoint الجديد

### معلومات الـ API

**Method:** `POST`  
**URL:** `/api/travel-bag/estimate-weight`  
**Authentication:** مطلوب (Bearer Token)  
**Language:** يدعم العربية والإنجليزية (حسب `Accept-Language` header)

---

## المعاملات المطلوبة

### Request Body

يجب إرسال JSON object يحتوي على:

| الحقل | النوع | المطلوب | الوصف |
|------|------|---------|-------|
| `custom_item_name` | String | نعم | اسم العنصر المخصص الذي يريد المستخدم تقدير وزنه |

### مثال على Request Body:

```json
{
    "custom_item_name": "محمول شخصي"
}
```

---

## الـ Response

### عند النجاح (200 OK)

يرجع الـ API البيانات التالية:

| الحقل | النوع | الوصف |
|------|------|-------|
| `status` | Integer | كود الحالة (200) |
| `message` | String | رسالة النجاح |
| `data` | Object | يحتوي على البيانات التالية: |
| `data.item_name` | String | اسم العنصر الذي تم تقدير وزنه |
| `data.estimated_weight_kg` | Float | الوزن المقدر بالكيلوجرام |
| `data.estimated_weight_grams` | Float | الوزن المقدر بالجرام |

### مثال على Response الناجح:

```json
{
    "status": 200,
    "message": "Weight estimated successfully",
    "data": {
        "item_name": "محمول شخصي",
        "estimated_weight_kg": 0.5,
        "estimated_weight_grams": 500.0
    }
}
```

---

## حالات الخطأ

### 1. خطأ التحقق من البيانات (400 Bad Request)

يحدث عندما لا يتم إرسال `custom_item_name` أو كان فارغاً.

**مثال على Response:**

```json
{
    "status": 400,
    "message": "Item name is required",
    "data": []
}
```

### 2. خطأ في الخادم (500 Internal Server Error)

يحدث عند حدوث خطأ في خدمة الذكاء الاصطناعي أو في معالجة الطلب.

**مثال على Response:**

```json
{
    "status": 500,
    "message": "Failed to estimate weight: {error message}",
    "data": []
}
```

---

## سيناريو الاستخدام في التطبيق

### الخطوات المقترحة للتنفيذ:

1. **عند إدخال اسم العنصر المخصص:**
   - عندما ينتهي المستخدم من كتابة اسم العنصر (مثلاً بعد ثانية من توقف الكتابة)
   - أو عند الضغط على زر "تقدير الوزن" إذا كان متوفراً

2. **استدعاء الـ API:**
   - إرسال طلب POST إلى `/api/travel-bag/estimate-weight`
   - إرسال `custom_item_name` في body
   - التأكد من إرسال `Authorization` header مع الـ token
   - إرسال `Accept-Language` header (ar أو en)

3. **عرض النتيجة:**
   - إذا نجح الطلب: عرض الوزن المقدر في حقل الوزن تلقائياً
   - يمكن إظهار مؤشر تحميل أثناء الطلب
   - يمكن إضافة زر "استخدام الوزن المقدر" أو "تعديل الوزن"

4. **إتاحة التعديل:**
   - يجب أن يتمكن المستخدم من تعديل الوزن المقدر إذا أراد
   - الوزن المقدر هو مجرد اقتراح، والمستخدم له الحرية في تغييره

5. **إضافة العنصر:**
   - بعد التأكيد، استخدام `/api/travel-bag/add-item` مع `custom_weight` المحدد
   - يمكن استخدام الوزن المقدر أو الوزن المعدل من قبل المستخدم

---

## تجربة المستخدم المقترحة (UX)

### خيار 1: التقدير التلقائي
- عندما يكتب المستخدم اسم العنصر، يتم استدعاء API تلقائياً بعد توقف الكتابة
- يتم ملء حقل الوزن تلقائياً بالقيمة المقدرة
- إظهار أيقونة صغيرة تشير إلى أن الوزن تم تقديره بواسطة AI

### خيار 2: زر "تقدير الوزن"
- إضافة زر بجانب حقل اسم العنصر: "تقدير الوزن"
- عند الضغط، يتم استدعاء API وعرض مؤشر تحميل
- بعد النجاح، يتم ملء حقل الوزن بالقيمة المقدرة

### خيار 3: مزيج من الاثنين
- تقدير تلقائي بعد إدخال الاسم
- إمكانية إعادة التقدير عن طريق زر "تقدير مرة أخرى"

---

## ملاحظات مهمة للمطورين

1. **التوقيت:**
   - يُنصح بإضافة تأخير (debounce) قبل استدعاء API لتجنب الطلبات المتكررة أثناء الكتابة
   - مثال: انتظار 1-2 ثانية بعد توقف المستخدم عن الكتابة

2. **معالجة الأخطاء:**
   - في حالة فشل API، يجب أن يستمر المستخدم في إمكانية إدخال الوزن يدوياً
   - عدم منع المستخدم من المتابعة إذا فشل التقدير

3. **التحسينات:**
   - يمكن تخزين الأوزان المقدرة محلياً لتقليل الطلبات المتكررة
   - يمكن إظهار رسالة تنبيه إذا كان الوزن المقدر كبيراً جداً

4. **التحقق:**
   - حتى بعد الحصول على وزن مقدر، يجب التأكد من التحقق من البيانات قبل الإرسال
   - الوزن المقدر يجب أن يكون ضمن النطاق المسموح (0.001 - 100 كجم)

5. **تجربة المستخدم:**
   - إظهار مؤشر تحميل أثناء انتظار الرد من API
   - جعل الوزن المقدر قابلاً للتعديل بسهولة
   - إضافة رسالة توضيحية أن الوزن مقدر بواسطة AI

---

## أمثلة على العناصر

فيما يلي بعض الأمثلة على العناصر التي يمكن تقدير وزنها:

- ملابس: "قميص"، "بنطال جينز"، "جاكيت شتوي"
- إلكترونيات: "لابتوب"، "كاميرا"، "شاحن محمول"
- مستلزمات: "شامبو سفر"، "فرشاة أسنان"، "منشفة"
- أدوات: "ساعة يد"، "نظارات شمسية"، "محفظة"

---

## التكامل مع إضافة العنصر

بعد الحصول على الوزن المقدر، يمكن استخدامه في endpoint إضافة العنصر:

**Endpoint:** `POST /api/travel-bag/add-item`

**Request Body:**
```json
{
    "custom_item_name": "محمول شخصي",
    "custom_weight": 0.5,
    "quantity": 1,
    "bag_type_id": 1
}
```

---

## الخلاصة

هذه الميزة تضيف قيمة كبيرة لتجربة المستخدم من خلال:
- ✅ توفير الوقت في إدخال الوزن يدوياً
- ✅ تقديم تقديرات واقعية بناءً على الذكاء الاصطناعي
- ✅ تحسين دقة تخطيط وزن الحقيبة
- ✅ تسهيل إضافة العناصر المخصصة

المستخدم لا يزال قادراً على تعديل الوزن المقدر حسب رغبته، مما يجعل الميزة مرنة ومفيدة في نفس الوقت.

